<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>통계</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  </head>
  <body>
    <!-- 메인 버튼 추가 -->
    <button id="mainButton">메인</button><br>
    
    <!-- 너비(width), 높이(height) 설정 -->
    <div id="main" style="width: 600px;height:400px;"></div>
    <!-- 초기화 및 차트 옵션 설정 -->
    <script>
        var bookCount;

        // URL 파라미터 값을 가져오는 함수
        function getParameterByName(name, url) {
          if (!url) url = window.location.href;
          name = name.replace(/[\[\]]/g, "\\$&");
          var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
              results = regex.exec(url);
          if (!results) return null;
          if (!results[2]) return '';
          return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        function loadStats() {
            // id 파라미터 값을 가져오기
            var idParam = getParameterByName('id');

            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function() {
                 if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    var responseData = xmlhttp.responseText.split('\n');
                    var oneBookCount = responseData[0];
                    var twoBookCount = responseData[1];
                    var threeBookCount = responseData[2];

                    //window.alert(oneBookCount+" "+twoBookCount+" "+threeBookCount);


                    // 1. 준비한 DOM 컨테이너에서 echarts 초기화하기
                    let myChart = echarts.init(document.getElementById('main'))

                    // 2. 차트 옵션 작성하기
                    let option = {
                      // 차트 제목
                      title: {
                        text: '지난 세 달의 읽은 권 수를 알려드려요',
                      },
                      // 범례명
                      legend: {
                        data: ['권'],
                        top: 20,
                      },
                      // x축 라벨
                      xAxis: {
                        data: ['저저번달', '저번달', '이번달'],
                      },
                      yAxis: {},
                      series: [
                        {
                          name: '개수',
                          type: 'bar', // 막대 그래프
                          data: [threeBookCount, twoBookCount, oneBookCount],
                        },
                      ],
                    }

                    myChart.setOption(option)
                }
            };
            
            // 수정된 부분: URL 파라미터 값을 넣어서 요청
            xmlhttp.open("GET", "getStats.jsp?id=" + idParam, true);
            xmlhttp.send();
        }

        // 페이지 로딩 시 함수 실행
        window.onload = function() {
            loadStats();
            
            // 수정된 부분: 버튼 클릭 시 메인 페이지로 이동하도록 처리
            var mainButton = document.getElementById('mainButton');
            if (mainButton) {
                mainButton.addEventListener('click', function() {
                    var idParam = getParameterByName('id');
                    window.location.href = 'main.jsp?id=' + idParam;
                });
            }
        };
    </script>
  </body>
</html>
