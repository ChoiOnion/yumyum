<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <title>캘린더</title>
    <link rel="stylesheet" href="main.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>

    <style>
        #calendar {
            width: 80vw;
            height: 80vh;
            margin: 0 auto;
        }
         
    </style>
</head>

<body>
    <button id="mainButton" >메인</button><br>

    <!-- 실제 화면을 담을 영역 -->
    <p id='calendar'></p>

    <script>
		
		var idParam = getParameterByName('id');
		function getParameterByName(name, url) {
          if (!url) url = window.location.href;
          name = name.replace(/[\[\]]/g, "\\$&");
          var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
              results = regex.exec(url);
          if (!results) return null;
          if (!results[2]) return '';
          return decodeURIComponent(results[2].replace(/\+/g, " "));
        }
        
        // window.onload에 함수 참조를 할당
        window.onload = function () {
            loadPosts();
            
            var mainButton = document.getElementById('mainButton');
            if (mainButton) {
                mainButton.addEventListener('click', function() {
                    var idParam = getParameterByName('id');
                    window.location.href = 'main.jsp?id=' + idParam;
                });
            }
        };

        $(function () {
            var request = $.ajax({
                url: "getCalendar.jsp?id=" + idParam, // 여기에 적절한 id 값을 넣어주세요.
                method: "GET",
                dataType: "json"
            });

            request.done(function (data) {
                console.log(data);

                var calendarEl = document.getElementById('calendar');

                var calendar = new FullCalendar.Calendar(calendarEl, {
					eventColor : 'orange', 
                    initialView: 'dayGridMonth',
                    headerToolbar: {
                        left: 'prevYear,prev,next,nextYear',
                        center: 'title',
                        right: 'today dayGridMonth'
                    },
                    events: data,
                    displayEventTime: false
                });

                calendar.render();
            });

            request.fail(function (jqXHR, textStatus) {
                alert("Request failed: " + textStatus);
            });
        });

        function loadPosts() {
			
			
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                }
            };
            xmlhttp.open("GET", "getCalendar.jsp?id=" + idParam, true); // 여기에 적절한 id 값을 넣어주세요.
            xmlhttp.send();
        }
    </script>
</body>

</html>